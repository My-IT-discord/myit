addEventListener("load",(()=>{let e=document.getElementsByClassName("bulletin")[0];fetch("data/bulletin.json").then((e=>e.json())).then((l=>{l.forEach((l=>{if(0!==l?.type)return;let t=document.createElement("div");t.classList.add("msg");let s=l.mention_roles,a=l.mention_channels;l.content=l.content?.replaceAll(/(https?:\/\/(www\.)?[a-z0-9]+([\-\.][a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?|discord\.gg\/[a-zA-Z0-9]*)/gm,(e=>`<a href="${e}">${e}</a>`))?.replaceAll(/(?<!\\)<(@&|@!|@)(?<roleId>[0-9]+)>/gmu,((e,l,t)=>{let a=s[t];if(!a)return e;let n=a.color?.toString(16);return`<span class="mention" style="color: #${n};background-color: #${n}1a;--have-color: #${n}50">@${a.name}</span>`}))?.replaceAll(/(?<!\\)<[^ ]*:[^ ]+:(?<emojiId>[0-9]+)>/gmu,((e,l)=>(console.log(e),`<img emoji class="emoji" src="https://cdn.discordapp.com/emojis/${l}.png"/>`)))?.replaceAll(/(?<!\\)<(#)[0-9]+>/gm,(e=>{let l=a[/[0-9]+/.exec(e)];return l?`<a href="https://discord.com/channels/${l.guild_id}/${l.id}" class="mention mention_channel">#${l.name}</a>`:e}))?.replaceAll(/(?<!\\)\|(?<!\\)\|.*(?<!\\)\|(?<!\\)\|/gmu,(e=>`<span class="spoilerText">${e.slice(2,-2)}</span>`))?.replaceAll(/^> .+/gm,((e,l,t)=>`${/^> .+/.test(t.slice(0,l).split(/^/).slice(-1))?"":"<blockquote>"}${e.substring(1)}${/^> .+/.test(t.slice(l).split("\n").slice(1)[0])?"":"</blockquote>"}`))?.replaceAll(/(?<!\\)\*(?<!\\)\*.+(?<!\\)\*(?<!\\)\*/gmu,(e=>`<strong>${e.slice(2,-2)}</strong>`))?.replaceAll(/\\(<|>|\|)/gm,(e=>e.slice(-1)))?.replaceAll("\n","<br />"),t.innerHTML=`<div class="info"><div class="author"><img src="https://cdn.discordapp.com/avatars/${l.author.id}/${l.author.avatar}.png" alt="" class="radius"><p>${l.author.username}</p></div><div class="timestamp">${(new Date).toLocaleString("zh-TW",{timeZone:"Asia/Taipei"})}</div></div><div class="content">${l.content}</div><div class="embeds"></div>`,e.appendChild(t);for(let e of document.getElementsByClassName("spoilerText"))e.addEventListener("click",(e=>e.target.classList.toggle("show")))}))}))}));
